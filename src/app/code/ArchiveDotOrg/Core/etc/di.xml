<?xml version="1.0"?>
<!--
/**
 * ArchiveDotOrg Core Module - Dependency Injection Configuration
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">

    <!-- Logger Configuration -->
    <type name="ArchiveDotOrg\Core\Logger\Handler">
        <arguments>
            <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
        </arguments>
    </type>

    <type name="ArchiveDotOrg\Core\Logger\Logger">
        <arguments>
            <argument name="name" xsi:type="string">archivedotorg</argument>
            <argument name="handlers" xsi:type="array">
                <item name="system" xsi:type="object">ArchiveDotOrg\Core\Logger\Handler</item>
            </argument>
        </arguments>
    </type>

    <!-- Interface Preferences (Service Contracts) -->
    <preference for="ArchiveDotOrg\Core\Api\Data\ShowInterface"
                type="ArchiveDotOrg\Core\Model\Data\Show"/>

    <preference for="ArchiveDotOrg\Core\Api\Data\TrackInterface"
                type="ArchiveDotOrg\Core\Model\Data\Track"/>

    <preference for="ArchiveDotOrg\Core\Api\Data\ImportResultInterface"
                type="ArchiveDotOrg\Core\Model\Data\ImportResult"/>

    <preference for="ArchiveDotOrg\Core\Api\ArchiveApiClientInterface"
                type="ArchiveDotOrg\Core\Model\ArchiveApiClient"/>

    <preference for="ArchiveDotOrg\Core\Api\AttributeOptionManagerInterface"
                type="ArchiveDotOrg\Core\Model\AttributeOptionManager"/>

    <preference for="ArchiveDotOrg\Core\Api\TrackImporterInterface"
                type="ArchiveDotOrg\Core\Model\TrackImporter"/>

    <preference for="ArchiveDotOrg\Core\Api\ShowImporterInterface"
                type="ArchiveDotOrg\Core\Model\ShowImporter"/>

    <preference for="ArchiveDotOrg\Core\Api\ProgressTrackerInterface"
                type="ArchiveDotOrg\Core\Model\ProgressTracker"/>

    <preference for="ArchiveDotOrg\Core\Api\ImageImportServiceInterface"
                type="ArchiveDotOrg\Core\Model\ImageImportService"/>

    <preference for="ArchiveDotOrg\Core\Api\BulkProductImporterInterface"
                type="ArchiveDotOrg\Core\Model\BulkProductImporter"/>

    <preference for="ArchiveDotOrg\Core\Api\CategoryAssignmentServiceInterface"
                type="ArchiveDotOrg\Core\Model\CategoryAssignmentService"/>

    <preference for="ArchiveDotOrg\Core\Api\ImportManagementInterface"
                type="ArchiveDotOrg\Core\Model\ImportManagement"/>

    <preference for="ArchiveDotOrg\Core\Api\Data\ImportJobInterface"
                type="ArchiveDotOrg\Core\Model\Data\ImportJob"/>

    <preference for="ArchiveDotOrg\Core\Api\Data\CollectionInfoInterface"
                type="ArchiveDotOrg\Core\Model\Data\CollectionInfo"/>

    <preference for="ArchiveDotOrg\Core\Api\ImportPublisherInterface"
                type="ArchiveDotOrg\Core\Model\Queue\ImportPublisher"/>

    <preference for="ArchiveDotOrg\Core\Api\MetadataDownloaderInterface"
                type="ArchiveDotOrg\Core\Model\MetadataDownloader"/>

    <preference for="ArchiveDotOrg\Core\Api\TrackPopulatorServiceInterface"
                type="ArchiveDotOrg\Core\Model\TrackPopulatorService"/>

    <preference for="ArchiveDotOrg\Core\Api\AlbumArtworkServiceInterface"
                type="ArchiveDotOrg\Core\Model\AlbumArtworkService"/>

    <preference for="ArchiveDotOrg\Core\Api\LockServiceInterface"
                type="ArchiveDotOrg\Core\Model\LockService"/>

    <preference for="ArchiveDotOrg\Core\Api\ArtistConfigValidatorInterface"
                type="ArchiveDotOrg\Core\Model\ArtistConfigValidator"/>

    <preference for="ArchiveDotOrg\Core\Api\TrackMatcherServiceInterface"
                type="ArchiveDotOrg\Core\Model\TrackMatcherService"/>

    <preference for="ArchiveDotOrg\Core\Api\Data\MatchResultInterface"
                type="ArchiveDotOrg\Core\Model\Data\MatchResult"/>

    <preference for="ArchiveDotOrg\Core\Api\StringNormalizerInterface"
                type="ArchiveDotOrg\Core\Model\StringNormalizer"/>

    <preference for="ArchiveDotOrg\Core\Api\ArtistConfigLoaderInterface"
                type="ArchiveDotOrg\Core\Model\ArtistConfigLoader"/>

    <!-- Console Commands -->
    <type name="Magento\Framework\Console\CommandList">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="archivedotorg_import_shows" xsi:type="object">ArchiveDotOrg\Core\Console\Command\ImportShowsCommand</item>
                <item name="archivedotorg_sync_albums" xsi:type="object">ArchiveDotOrg\Core\Console\Command\SyncAlbumsCommand</item>
                <item name="archivedotorg_status" xsi:type="object">ArchiveDotOrg\Core\Console\Command\StatusCommand</item>
                <item name="archivedotorg_cleanup_products" xsi:type="object">ArchiveDotOrg\Core\Console\Command\CleanupProductsCommand</item>
                <item name="archivedotorg_refresh_products" xsi:type="object">ArchiveDotOrg\Core\Console\Command\RefreshProductsCommand</item>
                <item name="archivedotorg_download_metadata" xsi:type="object">ArchiveDotOrg\Core\Console\Command\DownloadMetadataCommand</item>
                <item name="archivedotorg_download" xsi:type="object">ArchiveDotOrg\Core\Console\Command\DownloadCommand</item>
                <item name="archivedotorg_populate_tracks" xsi:type="object">ArchiveDotOrg\Core\Console\Command\PopulateTracksCommand</item>
                <item name="archivedotorg_populate" xsi:type="object">ArchiveDotOrg\Core\Console\Command\PopulateCommand</item>
                <item name="archivedotorg_show_unmatched" xsi:type="object">ArchiveDotOrg\Core\Console\Command\ShowUnmatchedCommand</item>
                <item name="archivedotorg_download_album_art" xsi:type="object">ArchiveDotOrg\Core\Console\Command\DownloadAlbumArtCommand</item>
                <item name="archivedotorg_update_category_artwork" xsi:type="object">ArchiveDotOrg\Core\Console\Command\UpdateCategoryArtworkCommand</item>
                <item name="archivedotorg_set_artwork_url" xsi:type="object">ArchiveDotOrg\Core\Console\Command\SetArtworkUrlCommand</item>
                <item name="archivedotorg_retry_missing_artwork" xsi:type="object">ArchiveDotOrg\Core\Console\Command\RetryMissingArtworkCommand</item>
                <item name="archivedotorg_migrate_organize_folders" xsi:type="object">ArchiveDotOrg\Core\Console\Command\MigrateOrganizeFoldersCommand</item>
                <item name="archivedotorg_cleanup_cache" xsi:type="object">ArchiveDotOrg\Core\Console\Command\CleanupCacheCommand</item>
                <item name="archivedotorg_validate_artist" xsi:type="object">ArchiveDotOrg\Core\Console\Command\ValidateArtistCommand</item>
                <item name="archivedotorg_migrate_export" xsi:type="object">ArchiveDotOrg\Core\Console\Command\MigrateExportCommand</item>
                <item name="archivedotorg_setup_artist" xsi:type="object">ArchiveDotOrg\Core\Console\Command\SetupArtistCommand</item>
                <item name="archivedotorg_benchmark_matching" xsi:type="object">ArchiveDotOrg\Core\Console\Command\BenchmarkMatchingCommand</item>
                <item name="archivedotorg_benchmark_import" xsi:type="object">ArchiveDotOrg\Core\Console\Command\BenchmarkImportCommand</item>
                <item name="archivedotorg_benchmark_dashboard" xsi:type="object">ArchiveDotOrg\Core\Console\Command\BenchmarkDashboardCommand</item>
                <item name="archivedotorg_enrich_artist_data" xsi:type="object">ArchiveDotOrg\Core\Console\Command\EnrichArtistDataCommand</item>
                <item name="archivedotorg_backfill_recording_data" xsi:type="object">ArchiveDotOrg\Core\Console\Command\BackfillRecordingDataCommand</item>
                <item name="archivedotorg_discover_venues" xsi:type="object">ArchiveDotOrg\Core\Console\Command\DiscoverVenuesCommand</item>
            </argument>
        </arguments>
    </type>

    <!-- Artist Enrichment Services -->
    <type name="ArchiveDotOrg\Core\Model\WikipediaClient">
        <arguments>
            <argument name="jsonSerializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Json</argument>
            <argument name="logger" xsi:type="object">ArchiveDotOrg\Core\Logger\Logger</argument>
        </arguments>
    </type>

    <type name="ArchiveDotOrg\Core\Model\BraveSearchClient">
        <arguments>
            <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface</argument>
            <argument name="jsonSerializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Json</argument>
            <argument name="logger" xsi:type="object">ArchiveDotOrg\Core\Logger\Logger</argument>
        </arguments>
    </type>

    <type name="ArchiveDotOrg\Core\Model\ArchiveStatsService">
        <arguments>
            <argument name="resourceConnection" xsi:type="object">Magento\Framework\App\ResourceConnection</argument>
            <argument name="logger" xsi:type="object">ArchiveDotOrg\Core\Logger\Logger</argument>
        </arguments>
    </type>

    <type name="ArchiveDotOrg\Core\Model\ArtistEnrichmentService">
        <arguments>
            <argument name="wikipediaClient" xsi:type="object">ArchiveDotOrg\Core\Model\WikipediaClient</argument>
            <argument name="braveSearchClient" xsi:type="object">ArchiveDotOrg\Core\Model\BraveSearchClient</argument>
            <argument name="archiveStatsService" xsi:type="object">ArchiveDotOrg\Core\Model\ArchiveStatsService</argument>
            <argument name="categoryRepository" xsi:type="object">Magento\Catalog\Api\CategoryRepositoryInterface</argument>
            <argument name="logger" xsi:type="object">ArchiveDotOrg\Core\Logger\Logger</argument>
        </arguments>
    </type>

</config>
